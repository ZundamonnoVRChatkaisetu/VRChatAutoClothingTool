# VRChat Auto Clothing Tool - 進捗管理

## プロジェクト概要
VRChatで使用するアバターに衣装を自動で着せるツールを作成するプロジェクト。Boothなどで販売されている衣装は特定のアバターに最適化されているため、異なるアバターに着せる場合は手動調整が必要になる。このツールは、そのプロセスを自動化することを目的としている。

## 主な機能
- アバターと衣装のボーン構造の違いを考慮した自動調整
- 衣装のサイズをアバターの体型に合わせて自動調整
- Unity Editor内でのシンプルなUIを提供
- ボーンマッピングの手動調整機能
- 調整前のプレビュー機能
- 衣装の貫通検出と自動調整機能
- 衣装の微調整UI（リアルタイム反映）
- VRChat特有のボーンやコンポーネントに対応

## 技術的前提
- アバターと衣装でボーンの構造が異なる
- Unityで実装（C#）
- Unity 2019.4.31f1以上（VRChat SDK対応バージョン）

## 進捗状況

### 2025-03-19
- ✅ プロジェクトリポジトリを作成
- ✅ 進捗管理ファイルを作成
- ✅ 参考資料の分析を実施
- ✅ メインエディタウィンドウ（AutoClothingWindow.cs）を実装
- ✅ ボーン調整ユーティリティ（BoneAdjuster.cs）を実装
- ✅ VRChat特有のアバター処理ユーティリティ（VRChatAvatarUtility.cs）を実装
- ✅ メッシュ処理ユーティリティ（MeshUtility.cs）を実装
- ✅ 詳細なREADMEと使用方法の作成
- ✅ 追加の特定ボーン（UpperLeg.L/R、Shoulder.L/R等）へのサポートを追加
- ✅ 衣装がアバターに貫通しないようにチェックする処理を強化
- ✅ 衣装の微調整UI改良とリアルタイム反映機能の追加
- ✅ 全体の実装完了

### 追加機能と改良（最新バージョン）
- 衣装がアバターに貫通している部分を検出し、自動的に調整する機能を強化
  - 複数のアバターメッシュとの貫通チェックに対応
  - より精密な貫通深度の検出と調整を実装
  - 貫通検出設定のカスタマイズUIを追加
- 衣装の微調整機能の向上
  - リアルタイムでの調整反映機能を追加
  - サイズ、位置、回転の微調整UIを改良
  - 調整の確定・リセット機能を追加
- ボーン取得機能の拡張
  - 「UpperLeg.L/R」と「UpperLeg_L/R」に対応
  - 「Shoulder.L/R」と「Shoulder_L/R」に対応
  - ドット形式とアンダースコア形式の両方をサポート

## 実装内容

### 1. メインエディタウィンドウ（AutoClothingWindow.cs）
- Unityエディタ拡張ウィンドウの実装
- アバターと衣装の選択UI
- ボーンマッピング表示・編集UI
- スケーリング設定UI
- プレビュー・適用機能
- 衣装の微調整UI（リアルタイム反映）
- 貫通検出設定UI

### 2. ボーン調整ユーティリティ（BoneAdjuster.cs）
- ボーン構造の分析・マッピング機能
- 最も近いボーンを検索する機能
- 衣装のボーンをアバターのボーンに合わせて調整する機能
- スキンメッシュレンダラーの調整機能
- 追加ボーンパターン対応

### 3. VRChat特有のアバター処理（VRChatAvatarUtility.cs）
- アバータータイプの検出機能
- VRChatコンポーネントの識別機能
- アバターと衣装のスケール差の計算機能
- ダイナミックボーンやPhysBoneの調整機能

### 4. メッシュ処理ユーティリティ（MeshUtility.cs）
- スキンメッシュの調整処理
- ボーンウェイトの再分配機能
- バインドポーズの再計算機能
- メッシュのミラーリング機能
- マテリアルテクスチャのスケーリング調整機能
- 貫通検出と自動調整機能

## 今後の予定

### 機能強化
- メッシュの自動クリーンアップと最適化
- より高度なボーン構造の推定アルゴリズム
- VRChatアバター3.0のExpressionParametersとの連携

### ユーザビリティ向上
- プリセット保存・読み込み機能
- バッチ処理（複数の衣装を一括調整）
- チュートリアルウィザードの追加

### 問題点
- 非ヒューマノイドアバターへの対応強化が必要
- 複雑なボーン構造を持つ衣装の調整精度向上
- パフォーマンス最適化（大規模モデルの処理時間短縮）

## 検証状況
- 基本機能の実装は完了
- 実際のVRChatアバターと衣装での検証が次のステップ
- ユーザーフィードバックを収集し、改善点を特定する必要あり
