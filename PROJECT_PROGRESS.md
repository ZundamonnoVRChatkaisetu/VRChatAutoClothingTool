# VRChat Auto Clothing Tool - 進捗管理

## プロジェクト概要
VRChatで使用するアバターに衣装を自動で着せるツールを作成するプロジェクト。Boothなどで販売されている衣装は特定のアバターに最適化されているため、異なるアバターに着せる場合は手動調整が必要になる。このツールは、そのプロセスを自動化することを目的としている。

## 主な機能
- アバターと衣装のボーン構造の違いを考慮した自動調整
- 衣装のサイズをアバターの体型に合わせて自動調整
- Unity Editor内でのシンプルなUIを提供
- ボーンマッピングの手動調整機能
- 調整前のプレビュー機能
- 衣装の貫通検出と自動調整機能
- 衣装の微調整UI（リアルタイム反映）
- VRChat特有のボーンやコンポーネントに対応

## 技術的前提
- アバターと衣装でボーンの構造が異なる
- Unityで実装（C#）
- Unity 2019.4.31f1以上（VRChat SDK対応バージョン）

## 進捗状況

### 2025-03-19
- ✅ プロジェクトリポジトリを作成
- ✅ 進捗管理ファイルを作成
- ✅ 参考資料の分析を実施
- ✅ メインエディタウィンドウ（AutoClothingWindow.cs）を実装
- ✅ ボーン調整ユーティリティ（BoneAdjuster.cs）を実装
- ✅ VRChat特有のアバター処理ユーティリティ（VRChatAvatarUtility.cs）を実装
- ✅ メッシュ処理ユーティリティ（MeshUtility.cs）を実装
- ✅ 詳細なREADMEと使用方法の作成
- ✅ 追加の特定ボーン（UpperLeg.L/R、Shoulder.L/R等）へのサポートを追加
- ✅ 衣装がアバターに貫通しないようにチェックする処理を強化
- ✅ 衣装の微調整UI改良とリアルタイム反映機能の追加
- ✅ 全体の実装完了

### 2025-03-20
- ✅ 貫通検出の機能強化と精度向上
  - 複数のアバターメッシュとの貫通チェックに対応
  - より精密な貫通深度の検出と調整機能の実装
  - 貫通検出設定のカスタマイズUIを追加
- ✅ 衣装の微調整機能の向上
  - リアルタイム調整反映機能の改良
  - 調整の確定・リセット機能の強化
- ✅ コードの大規模なリファクタリング
  - 機能ごとに専用クラスに分割し保守性を向上
  - MeshUtility.cs → 基本的なメッシュ操作
  - PenetrationDetection.cs → 貫通検出・調整
  - BoneWeightUtility.cs → ボーンウェイト処理
  - MeshTransformation.cs → メッシュ変形・調整
  - BoneStructureAnalyzer.cs → ボーン構造分析
  - ClothingAdjuster.cs → 衣装調整メイン処理
  - FineAdjustmentHandler.cs → 微調整処理

## 実装内容

### 1. メインエディタウィンドウ（AutoClothingWindow.cs）
- Unityエディタ拡張ウィンドウの実装
- アバターと衣装の選択UI
- ボーンマッピング表示・編集UI
- スケーリング設定UI
- プレビュー・適用機能
- 衣装の微調整UI（リアルタイム反映）
- 貫通検出設定UI

### 2. ボーン関連機能（BoneStructureAnalyzer.cs, BoneAdjuster.cs）
- ボーン構造の分析・マッピング機能
- 最も近いボーンを検索する機能
- 衣装のボーンをアバターのボーンに合わせて調整する機能
- スキンメッシュレンダラーの調整機能
- 追加ボーンパターン対応（ドット形式とアンダースコア形式の両方をサポート）

### 3. VRChat特有のアバター処理（VRChatAvatarUtility.cs）
- アバータータイプの検出機能
- VRChatコンポーネントの識別機能
- アバターと衣装のスケール差の計算機能
- ダイナミックボーンやPhysBoneの調整機能

### 4. メッシュ処理機能（MeshUtility.cs, MeshTransformation.cs, BoneWeightUtility.cs）
- スキンメッシュの調整処理
- ボーンウェイトの再分配機能
- バインドポーズの再計算機能
- メッシュのミラーリング機能
- マテリアルテクスチャのスケーリング調整機能

### 5. 貫通検出と調整機能（PenetrationDetection.cs）
- 複数のアバターメッシュとの貫通チェック
- より精密な貫通深度の検出
- 複数の貫通に対する最適な調整方向の決定
- 優先順位付きメッシュ処理（ボディメッシュ優先）
- 高精度/低精度サンプリングの切り替え
- カスタマイズ可能な設定パラメータ

### 6. 衣装調整機能（ClothingAdjuster.cs）
- 衣装の自動調整処理の統合
- Undo対応
- プレビュー生成
- エラーハンドリング
- プレビュー用半透明マテリアルの適用

### 7. 微調整機能（FineAdjustmentHandler.cs）
- リアルタイムでの調整反映
- サイズ、位置、回転の微調整UI
- 調整のリセット・確定機能
- プリセット適用機能

## 今後の予定

### 機能強化
- メッシュの自動クリーンアップと最適化
- より高度なボーン構造の推定アルゴリズム
- VRChatアバター3.0のExpressionParametersとの連携
- 複数衣装の同時調整機能

### ユーザビリティ向上
- プリセット保存・読み込み機能の実装
- バッチ処理（複数の衣装を一括調整）
- チュートリアルウィザードの追加
- 日本語・英語の言語切り替え機能

### 問題点
- 非ヒューマノイドアバターへの対応強化が必要
- 複雑なボーン構造を持つ衣装の調整精度向上
- パフォーマンス最適化（大規模モデルの処理時間短縮）

## 検証状況
- 基本機能の実装は完了
- 改良された貫通検出機能のテストが必要
- 実際のVRChatアバターと衣装での追加検証が必要
- ユーザーフィードバックを収集し、改善点を特定する予定
